创作编辑器项目文档

## 1. 需求分析与文档

### REQ-010 —— 大纲模块
- **描述**：支持小说/故事结构与大纲的创建、编辑、保存与排序。
- **接受标准**：
  - 用户能够新增、修改、删除大纲及章节信息。
  - 支持章节的拖拽排序、自动保存（保存为本地文件）以及版本记录（本地版本历史）。
- **优先级**：高
- **依赖**：本地文件存储、综合文本编辑器

### REQ-011 —— 角色关系图（思维导图模式）
- **描述**：提供图形化编辑工具，采用思维导图形式展示人物及其关系，便于构建复杂角色网络。
- **接受标准**：
  - 用户能通过拖拽添加和修改角色节点及其关系（如亲情、友情、对立等）。
  - 支持节点的自由布局、缩放和动态编辑，数据与大纲模块联动（本地文件更新）。
- **优先级**：高
- **依赖**：大纲模块、综合文本编辑器

### REQ-012 —— 剧情联想模块
- **描述**：根据当前情节自动生成多条扩展建议，辅助创作灵感。
- **接受标准**：
  - 输入当前情节状态后，系统能返回 3-5 条情节扩展建议。
  - 可配置使用内置规则或外部 AI 模型（可离线调用轻量化模型）。
- **优先级**：中
- **依赖**：大纲模块

### REQ-013 —— 设定编辑与知识库模块
- **描述**：管理小说背景、世界观、设定信息，包括地理位置、人名、势力、功法/魔法、武器道具等。
- **接受标准**：
  - 用户可分类和标签化管理设定内容，并实现设定项之间的关联联想。
  - 知识库支持关键词检索、本地存储与数据导入/导出。
- **优先级**：高
- **依赖**：综合文本编辑器、本地文件（或轻量级本地存储方案）

### REQ-014 —— 错别字纠正模块
- **描述**：实时检测文本中的错别字，并提供自动或手动纠正建议。
- **接受标准**：
  - 检查准确率达到 95%以上。
  - 用户可选择自动修正或忽略提示。
- **优先级**：中
- **依赖**：综合文本编辑器、离线字典/本地 NLP 模型

### REQ-015 —— 语句段落润色优化模块
- **描述**：对文本中的语句和段落进行优化，提升语句流畅度和语法准确率，提供修改建议。
- **接受标准**：
  - 实时显示优化建议，允许用户预览和一键应用修改。
  - 优化建议符合语言逻辑，准确率达到90%以上。
- **优先级**：中
- **依赖**：综合文本编辑器、离线语言模型或预置润色规则

### REQ-016 —— 字数统计模块
- **描述**：实时统计文本字数（或字符数），支持整体及章节统计，并能对目标字数提供进度反馈。
- **接受标准**：
  - 显示总字数及各章节字数，并支持用户设置目标字数。
  - 当达到设定目标时提供提示或自动触发其它功能（如解锁写作模式）。
- **优先级**：中
- **依赖**：综合文本编辑器

### REQ-017 —— 知识库模块
- **描述**：建立并维护用于存储设定、情节、角色等素材的本地知识库。
- **接受标准**：
  - 支持关键词搜索、标签和分类管理。
  - 允许用户通过本地文件进行数据的导入/导出和更新。
- **优先级**：中
- **依赖**：设定编辑模块

### REQ-018 —— 综合文本编辑器
- **描述**：提供功能齐全的文本编辑环境（支持富文本、Markdown），集成前述各项文本处理功能。
- **接受标准**：
  - 支持新建、打开、保存（为本地文件）、导出文件功能。
  - 集成错别字检测、字数统计、自动保存、历史记录等功能。
  - 用户界面流畅，编辑无延迟，体验优秀。
- **优先级**：高
- **依赖**：本地文件存储

### REQ-019 —— 文本转语音 (TTS) 模块
- **描述**：将编辑文本转换为语音输出，辅助创作者检视文本表达效果。
- **接受标准**：
  - 支持多语种，并允许调节语速与语调。
  - 播放延迟低于2秒，并支持导出为音频文件（全部离线或基于本地调用）。
- **优先级**：中
- **依赖**：综合文本编辑器、离线 TTS 组件或接口

### REQ-020 —— 锁定阅读模式
- **描述**：提供专注阅读功能，激活后仅显示文本内容，屏蔽编辑功能，提升阅读专注度。
- **接受标准**：
  - 实现全屏与夜间模式。
  - 模式切换流畅，确保用户专注于内容阅读，无误操作编辑。
- **优先级**：低
- **依赖**：前端框架及本地界面管理

### REQ-021 —— 小黑屋（专注写作模式）
- **描述**：提供“写作模式”，允许用户设定目标字数，激活后锁定当前编辑器，限制切换其他应用（或通过界面伪锁定实现），达到目标自动解锁。
- **接受标准**：
  - 用户可设定目标字数（例如 1000 或 5000 字）。
  - 模式激活后，系统锁定当前编辑器（支持全屏锁定或禁止操作其他应用），并显示实时写作进度。
  - 达到目标后自动解锁，并给予完成提示。
- **优先级**：高
- **依赖**：综合文本编辑器、字数统计模块、系统级或前端伪锁定机制

---

## 2. 系统架构与模块任务分解

本项目采用前端为主、单机本地存储的设计，各模块均作为独立组件运行，通过插件或模块接口进行交互，所有数据均保存为本地文件（如 JSON、Markdown、XML 等格式），适用于电脑端及移动端环境。

### 阶段 1：基础编辑器平台与本地存储支持 (Weeks 1-3)
**TASK-A02** —— 综合文本编辑器构建
- **描述**：开发支持 Markdown 与富文本编辑的核心编辑器，内置自动保存（本地存储功能）。
- **交付成果**：
  - 基础编辑器（打开、编辑、保存、导出为文件）。
  - 集成实时字数统计、历史记录与本地文件格式管理。
- **成功指标**：响应时间 < 1秒，字数统计与文件保存100%正常工作。

### 阶段 2：辅助创作功能模块开发 (Weeks 4-6)
**TASK-B01** —— 大纲模块与思维导图式角色关系图
- **描述**： 
  - 实现大纲模块，支持章节的新增、删除、修改及拖拽排序（数据存储在本地文件中）。
  - 基于思维导图风格实现角色关系图编辑，用户可直观地布局角色及关系，数据与大纲联动更新。
- **交付成果**：
  - 大纲编辑器和联动的角色关系（思维导图）工具。
- **成功指标**：操作延迟 < 500ms，模块间数据联动准确无误。

**TASK-B02** —— 剧情联想功能
- **描述**：整合内置或离线 AI 模型/规则库，提供情节扩展建议。
- **交付成果**：
  - 简单易用的情节联想工具，支持用户反馈调整。
- **成功指标**：建议推荐准确率 ≥ 80%。

**TASK-B03** —— 设定编辑与知识库
- **描述**：
  - 构建设定内容管理界面，支持对地理、人物、势力、功法/魔法、武器等进行分类管理与关联。
  - 建立基于本地文件的知识库，支持标签检索与数据导入/导出。
- **交付成果**：
  - 设定管理面板和本地知识库模块。
- **成功指标**：检索准确率 ≥ 90%。

### 阶段 3：语言优化、多媒体与辅助写作功能 (Weeks 7-9)
**TASK-C01** —— 错别字纠正与语句润色模块
- **描述**：集成离线 NLP 模型或内置字典，提供实时文本校正与段落优化建议。
- **交付成果**：
  - 实时提示和一键应用纠错、语句润色插件。
- **成功指标**：错字检测准确率 ≥ 95%，语句优化建议符合预期。

**TASK-C02** —— 文本转语音 (TTS)
- **描述**：结合离线 TTS 组件或轻量接口，实现文本转语音功能。
- **交付成果**：
  - 能调节语速、语调的 TTS 播放组件，并支持音频导出。
- **成功指标**：转换延迟 < 2秒，语音清晰流畅。

### 阶段 4：专注模式与阅读体验优化 (Weeks 10-11)
**TASK-D01** —— 锁定阅读模式
- **描述**：开发简洁的全屏纯阅读界面，支持夜间模式等特色。
- **交付成果**：
  - 实现专注阅读（锁定非编辑状态）的界面组件。
- **成功指标**：切换流畅，无卡顿，界面简洁。

**TASK-D02** —— 小黑屋 —— 写作专注模式
- **描述**：开发“写作模式”，允许用户设定字数目标，并在激活后锁定当前编辑器，限制切换其他应用或最大程度减少干扰（前端伪锁定或系统级锁定，依据运行环境）。
- **交付成果**：
  - 提供实时字数统计、进度提示及自动解锁功能的专注写作模式。
- **成功指标**：模式稳定、进度提示准确、达标后自动解除锁定，无干扰体验。

---

## 3. 进度规划与里程碑

| 阶段                   | 开始日期 | 结束日期 | 关键里程碑                                           | 风险因素                               |
| ---------------------- | -------- | -------- | ---------------------------------------------------- | -------------------------------------- |
| 阶段 1：基础编辑器平台 | Week 1   | Week 3   | 完成综合文本编辑器，具备本地文件存储与自动保存       | 编辑器性能与跨平台兼容性问题           |
| 阶段 2：辅助创作功能   | Week 4   | Week 6   | 大纲、思维导图式角色关系、剧情联想及设定模块初步完成 | 数据联动准确性、交互响应延迟           |
| 阶段 3：语言优化与 TTS | Week 7   | Week 9   | 完成错别字纠正、语句润色与文本转语音功能             | 离线 NLP 模型稳定性、TTS 组件兼容性    |
| 阶段 4：专注模式       | Week 10  | Week 11  | 锁定阅读与小黑屋（写作专注）模式全面测试             | 前端锁定机制实现与写作模式用户体验风险 |

---

## 4. 技术架构与 SOLID 原则应用

### 单一职责原则 (SRP)
- **OutlineModule**：专注于大纲的创建、管理与本地文件存储。
- **MindMapModule**：专门负责基于思维导图的角色关系图绘制与编辑。
- **EditorCore**：负责文本编辑、字数统计、自动保存及历史记录管理。
- **FocusModeModule**：独立实现专注写作模式及锁定阅读模式的逻辑。

### 开放封闭原则 (OCP)
- 为各功能设计统一的抽象接口（如 ITextProcessor、ICharacterManager），便于未来扩展新功能而不修改已有模块。

### 里氏替换原则 (LSP)
- 模块接口标准化（例如大纲、设定、知识库模块），保证后续更换实现时不影响系统整体行为。

### 接口隔离原则 (ISP)
- 每个模块仅暴露必要的接口，例如 ISpellChecker 只提供文本校正相关方法，避免形成过于庞大的依赖。

### 依赖倒置原则 (DIP)
- 高层模块依赖于抽象接口（如 IEditorService），低层模块通过依赖注入（DI）实现，保证各组件独立且易于测试和维护。

---

## 5. 输出格式及示例

### 本地项目配置文件示例 (JSON)
```json
{
  "editorConfig": {
    "theme": "dark",
    "autoSaveInterval": 30000,
    "modules": {
      "outline": true,
      "mindMap": true,
      "plotAssistance": true,
      "settings": true,
      "autoCorrection": true,
      "textRefinement": true,
      "wordCount": true,
      "knowledgeBase": true,
      "TTS": true,
      "focusMode": true
    }
  }
}
```

### 小黑屋（写作模式）配置示例 (JSON)
```json
{
  "focusMode": {
    "targetWordCount": 1000,
    "lockScreen": true,
    "autoUnlock": true,
    "warningThreshold": 50
  }
}
```

### 文本编辑器示例界面 (Markdown)
```markdown
# 小说创作编辑器

## 大纲模块
- 新增章节、章节排序、自动保存（保存为本地文件）

## 思维导图（角色关系图）
- 拖拽添加角色、设定关系、实时联动大纲数据

## 专注写作模式（小黑屋）
- 目标字数：当前800 / 目标1000
- 模式激活后，编辑器锁定，降低外界干扰……
- 达到目标后自动解锁提示

## 操作面板
- [保存] [还原] [导出] [启用 TTS]
```

---

## 6. 实施建议

- **本地存储方案**：采用文件系统存储（如 JSON、Markdown、XML 文件），以保证用户的写作内容完全保存在其电脑或手机本地，无需后端服务器，确保隐私安全。
- **模块化开发**：各功能模块独立开发，使用插件化架构，各模块通过标准接口交互，便于日后扩展或维护。
- **离线功能**：考虑使用离线下的 NLP 模型、TTS 组件及字典数据，保证无网络环境下也能正常提供核心功能。
- **用户体验优化**：持续通过用户反馈优化大纲、思维导图和专注写作模式的交互界面，确保操作直观、无干扰。
- **安全性与稳定性**：自动保存、版本管理和本地备份机制均在本地实现，避免数据丢失，并定期建议用户手动备份数据以防万一。

---

**总结**

此次更新后的整体方案针对小说/故事创作编辑器进行了本地化调整，去除了后端与用户管理模块，所有数据均保存在用户设备上。功能模块包括大纲编辑、思维导图形式的角色关系图、剧情联想、设定管理、错别字检测、语句润色、字数统计、知识库、文本编辑、文本转语音（TTS）、锁定阅读和专注写作模式（小黑屋）。方案采用模块化设计和 SOLID 原则，确保系统高扩展性、易维护性及用户隐私的最大保障。